global
  maxconn 4096

defaults
  log             global
  mode            http
  retries         3
  timeout connect 5000ms
  timeout client  50000ms
  timeout server  50000ms
  option httpclose
  balance leastconn

listen stats
  bind *:9000
  stats uri /stats
  stats enable
  stats auth admin:admin

frontend http-in
  bind *:80
  mode http
  option httplog
  option dontlognull
  option forwardfor
  option http-server-close
  acl host_adubs hdr_beg(host) -i adubs
  use_backend adubs_cluster if host_adubs
  acl host_batch-update hdr_beg(host) -i batch-update
  use_backend batch-update_cluster if host_batch-update
  acl host_ci hdr_beg(host) -i ci
  use_backend ci_cluster if host_ci
  acl host_consul hdr_beg(host) -i consul
  use_backend consul_cluster if host_consul
  acl host_coregi hdr_beg(host) -i coregi
  use_backend coregi_cluster if host_coregi
  acl host_deliveryhandler hdr_beg(host) -i deliveryhandler
  use_backend deliveryhandler_cluster if host_deliveryhandler
  acl host_fleet hdr_beg(host) -i fleet
  use_backend fleet_cluster if host_fleet
  acl host_haproxy-consul-80 hdr_beg(host) -i haproxy-consul-80
  use_backend haproxy-consul-80_cluster if host_haproxy-consul-80
  acl host_teamshandler hdr_beg(host) -i teamshandler
  use_backend teamshandler_cluster if host_teamshandler


backend adubs_cluster
  server ip-10-252-128-73.gettywan.com 10.252.128.73:49159 check

backend batch-update_cluster
  server ip-10-252-129-45.gettywan.com 10.252.129.45:49155 check

backend ci_cluster
  server ip-10-252-128-73.gettywan.com 10.252.128.73:49153 check

backend consul_cluster
  server ip-10-252-128-108.gettywan.com 10.252.128.108:8300 check
  server ip-10-252-128-109.gettywan.com 10.252.128.109:8300 check
  server ip-10-252-129-164.gettywan.com 10.252.129.164:8300 check

backend coregi_cluster
  server ip-10-252-128-108.gettywan.com 10.252.128.108:3000 check
  server ip-10-252-128-109.gettywan.com 10.252.128.109:3000 check
  server ip-10-252-128-73.gettywan.com 10.252.128.73:3000 check
  server ip-10-252-129-164.gettywan.com 10.252.129.164:3000 check
  server ip-10-252-129-45.gettywan.com 10.252.129.45:3000 check
  server ip-10-252-129-46.gettywan.com 10.252.129.46:3000 check

backend deliveryhandler_cluster
  server ip-10-252-129-45.gettywan.com 10.252.129.45:49156 check

backend fleet_cluster
  server ip-10-252-129-164.gettywan.com 10.252.129.164:49153 check

backend haproxy-consul-80_cluster
  server ip-10-252-128-108.gettywan.com 10.252.128.108:80 check
  server ip-10-252-128-109.gettywan.com 10.252.128.109:80 check
  server ip-10-252-129-164.gettywan.com 10.252.129.164:80 check

backend teamshandler_cluster
  server ip-10-252-128-73.gettywan.com 10.252.128.73:49158 check

